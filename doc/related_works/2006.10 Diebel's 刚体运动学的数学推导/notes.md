
# 摘要
  * 表示了3D中刚体姿态表示IDE三个主要数学构造：旋转矩阵，欧拉角三元组，单位四元数。
  * 还增加了第四个：rotation vector，对欧拉角和四元素都有很多好处，并且没有前者的奇异性，没有后者的二次约束条件（即，四元数范数必须是为1）。
  * 还有很多附加表示，例如 Cayley-Klein 参数，轴角表示，也描述了它们与三个主要表示的关系。
  * 我们的阐述适用于那些希望了解该主题的全面且统一的参考资料的读者；因此，我们没有提供一些结果的详细推导。
# 引言
  本文旨在作为关于在三维空间中参数化物体姿态的统一参考资料。它的撰写是为了填补现有在线文献中的空白。特别地，虽然有许多网页和技术报告专门介绍欧拉角和四元数，但我们无法找到一本单一的参考书，以一致、详细和统一的方式涵盖所有主题。这个问题在当前使用的众多约定中尤为严重，作者倾向于假设某个约定而没有明确说明他们的选择，也没有评论其他选择。此外，现有的在线文献在欧拉角三元组的各种可能选择方面存在特别大的空白。
  最常用的表示刚体姿态的方式是三个欧拉角。这些角度流行是因为它们易于理解和使用。一些欧拉角集合使用得如此广泛，以至于它们已经成为了通俗用语的一部分，例如飞机的翻滚角、俯仰角和偏航角。欧拉角的主要缺点是：(1)某些重要的欧拉角函数具有奇点，(2)在用于随时间积分姿态的增量变化时，精度比四元数低。
  欧拉角表示中的这些缺陷促使研究人员使用四元数作为刚体姿态的参数化。四元数的相关函数没有奇点，表示方法适合随时间积分刚体的角速度。使用四元数的主要缺点是：(1)四个四元数参数没有直观的物理意义，(2)四元数必须具有单位范数才能成为纯旋转。范数为1的约束条件，形式上是二次的，如果姿态参数要包括在优化中，这会导致特别麻烦，因为大多数标准优化算法无法编码这种约束。
  作为欧拉角和单位四元数的替代，我们提供旋转向量。旋转向量既没有欧拉角的奇点，也没有单位四元数的二次约束。这不是一种新的参数化方法，但我们发现现有的有关此主题的参考文献缺乏详细的信息。当试图在欧拉角奇点无法通过精心设计避免的情况下，优化姿态参数时，旋转向量特别有用。在其他情况下，它可能不是最佳选择。

## 1.1 内容概述
在第1.3节中，我们定义了在本文中使用的坐标系。第2节介绍了旋转矩阵的概念，并描述了它们的几个关键特性。刚体运动学在第3节中介绍。Euler角在第5节中以它们的多样性进行讨论，其中包括对三种最常用的约定的详细讨论。第6节讨论了四元数，特别是单位四元数和轴角表示。在第7节中，旋转向量作为四元数的三维参数化进行了研究。最后，在第8节中，我们提供了十二种不同的Euler角参数化的目录。在整篇文章中，我们在适当的地方包括不同表示之间的转换以及有关使用和命名约定的解释说明。

## 1.2 来源
本文中的数学结果是从基本定义和基本原理推导出来的。为了确认我们的结果并提供关于不同约定的使用信息，我们使用了几个参考文献。关于Euler角，我们引用了[1]和[4]。关于Caley-Klein参数，我们引用了[3]。关于四元数和Euler-Rodrigues参数，我们引用了[5]和[2]，特别是后者。关于运动学，我们引用了[1]。

## 1.3 坐标系
我们考虑表达在两个不同坐标系中的数据之间的关系：
• 世界坐标系固定在惯性空间中。该坐标系的原点表示为xw。
• 固连坐标系紧密连接到我们想要描述其态度的物体上。该坐标系的原点表示为xb。
在固连坐标系中表示的点和向量与在世界坐标系中表示的点和向量由一个撇号符号区分开。例如，如果x是在世界坐标系中的一个点，则x'是在固连坐标系中表示的相同点。不用说，xw和x'b都是零，但x'w和xb通常不是。这里，x'w表示在固连坐标系中表示的世界坐标系的原点，xb表示在世界坐标系中表示的固连坐标系的原点。
本文中描述的某些数学仅适用于世界坐标系是旋转固定的情况。然而，对于许多目的而言，认为缓慢旋转的坐标系（如连接到地球的坐标系）是一个有效的世界坐标系是完全可以接受的，尽管它具有非零的角速度。

# 2. 旋转矩阵
  一个旋转矩阵是一种矩阵，其乘以一个向量可以将向量旋转而保持其长度不变。所有 $3 \times 3$ 旋转矩阵的特殊正交群被记为 SO(3)。因此，如果 $R \in SO(3)$，则有 $det R = \pm 1$ 并且 $R^{-1} = R^T$。
  行列式 det R 等于 1 的旋转矩阵被称为 proper 矩阵，而 det R 等于 -1 的旋转矩阵被称为 improper 矩阵。improper 旋转也被称为 rotoinversions，它们由一个旋转操作后跟一个反转操作组成。我们限制我们的分析范围为 proper 旋转，因为 improper 旋转不是刚体变换。
  描述刚体姿态的旋转矩阵有两种可能的约定，目前都在使用。有些作者喜欢编写将从固定于物体的坐标系到世界坐标系的映射矩阵；而其他人则喜欢编写将从世界坐标系到固定于物体的坐标系的映射矩阵。虽然在这两种约定之间进行转换只需要执行矩阵的转置操作，但在同时使用两个不同来源的结果之前，有必要确保两个来源都使用相同的约定。实际上，这份报告的动机之一就是提供一个统一的参考资料，覆盖整个主题。
  
## 2.1 坐标变换

  我们定义编码刚体姿态的旋转矩阵为当其左乘一个在世界坐标系中表示的向量时，可以得到该向量在机体固定坐标系中表示的矩阵。也就是说，如果 $z\in R^3$ 是世界坐标系中的向量，$z'\in R^3$ 是相同向量在机体固定坐标系中表示的向量，那么有以下关系式：
  这些表达式适用于向量，即空间中没有位置的相对量。要将一个点从一个坐标系转换到另一个坐标系，我们必须在应用旋转矩阵之前减去目标坐标系的原点偏移量。因此，如果x ∈ R3是世界坐标系中的一个点，x′ ∈ R3是表示相同点的固定坐标系中的点，则我们可以写成：
  
## 2.2 变换矩阵
在计算机图形学领域，通常会将公式 6 和 7 写成矩阵-向量乘积的形式：......这种约定的广泛应用可能是由于其被 3D 加速图形硬件制造商所采用的缘故。

## 2.3 刚体的位姿
刚体的位姿是指该物体的位置和姿态。本报告的大部分内容都涉及姿态的参数化。位置最自然地用 $x_b$ 表示，即刚体固定坐标系原点在世界坐标系中的位置。然而，同样也可以使用 $x'_w$，即世界坐标系原点在刚体固定坐标系中的位置。这两个量通过刚体的姿态相互关联，根据公式 8 和 9。

## 2.4 坐标旋转
坐标旋转是绕单一坐标轴的旋转。用 1、2、3 枚举 x、y 和 z 轴，对于 i ∈ {1, 2, 3}，坐标旋转 Ri : R → SO(3) 如下：... 图 1 显示了一次绕 z 轴旋转 α 角度的样例旋转。

## 2.5 方向余弦矩阵
方向余弦矩阵也称旋转矩阵，因为该矩阵的元素是体轴坐标系和世界坐标系之间无符号角度的余弦值。用（x，y，z）表示世界坐标轴，用（x′，y′，z′）表示体轴坐标轴，例如，θx′,y是x′轴和y轴之间的无符号角度。用这些角度来表示旋转矩阵，可以写成...
为了用具体的例子说明，考虑图1所示的情况。在这种情况下，θx′,x = θy′,y = α，θx′,y = π/2 − α，θy′,x = π/2 + α，θz′,z = 0，θz′,{x,y} = θ{x′,y′},z = π/2。根据公式17，可以展开式子...
这与第2.4节中的公式16呈现的结果相同。

## 2.6 基向量
旋转矩阵也可以看作定义世界坐标系和固定于刚体的坐标系的基向量矩阵。旋转矩阵的行是以世界坐标系表示的固定于刚体坐标系的基向量，而列则是以固定于刚体坐标系表示的世界坐标系的基向量。

## 2.7 旋转矩阵的乘法
两个旋转矩阵相乘得到另一个旋转矩阵，其对点的作用与两个原始旋转矩阵的顺序应用所产生的旋转相同。例如，让......注意，旋转的顺序是相反的。也就是说，这里首先应用 $R_a$，然后再应用 $R_{b/a}$。

# 3. 运动学
运动学是研究粒子和刚体的运动，而不考虑所涉及的力和力矩。因此，它是研究三维空间性质的学科，至少部分属于本报告的范围。在本节中，我们呈现几个关键结果，但不进行推导。

## 3.1 记号
我们考虑物体b和粒子p在世界坐标系w中的运动。我们用b相对于w的运动和p相对于b的运动来表示p的速度和加速度。我们在这里定义相关的术语。
所有这些量都可以用世界坐标系或者体坐标系来表示，以哪个为方便就用哪个。体坐标系的量用撇号表示。向量在两个坐标系之间的转换根据公式4和5进行，点的转换使用公式6和7进行。在这里定义的所有量都是矢量量，除了xp和xb是点。
## 3.2 刚体上固定点的运动，
## 3.3 在移动参考系中的粒子运动

# 4 有限差分逼近
在本文的几个地方，刚体的角速度被关联到姿态参数的时间导数。在许多应用中，需要使用有限差分逼近来近似这些时间导数。在本节中，将介绍和讨论最常见和有用的有限差分逼近。
我们将讨论一个一般的时间变化的向量量 z(t) ∈ Rn。有限差分逼近用 ∆n
S,h 运算符表示，其中 n 是导数的阶数，S 是计算有限差分逼近的模板，h 是采样时间之间的大小。有限差分算子是在评估点附近的函数评估的线性组合。一般的有限差分逼近表示为：

# 5 欧拉角
## 5.1 旋转序列
三个坐标轴的旋转可以描述任何旋转。让我们考虑一个三重旋转，其中第一次旋转是绕 k 轴旋转 ψ 角，第二次旋转是绕 j 轴旋转 θ 角，第三次旋转是绕 i 轴旋转 φ 角。为了简洁起见，让我们将这些角度排列在一个三维向量中，称为欧拉角向量，定义为...

将欧拉角向量映射到其相应的旋转矩阵 Rijk：R3→SO（3）的函数是...

与一般情况一样，如果 z ∈ R3 是世界坐标系下的向量，z' ∈ R3 是在固定在刚体上的坐标系下相同的向量，则以下关系成立...

## 5.2 欧拉角速度和角速度
欧拉角向量的时间导数是欧拉角速度向量。欧拉角速度和刚体的角速度之间的关系被编码在欧拉角速度矩阵中。将该矩阵乘以欧拉角速度向量可得到全局坐标系下的角速度。设ˆei是第i个单位向量，将欧拉角向量映射到其相应的欧拉角速度矩阵的函数为E：R3→R3x3，其定义为：
...
另外还有相关的共轭欧拉角速度矩阵函数E′：R3→R3x3，将其与欧拉角速度向量相乘即可得到体坐标系下的角速度：
...

## 5.3 线性化
考虑关于0的线性化。
将 $\sin(\alpha)$替换为$\alpha$，将$\cos(\alpha)$替换为1，高阶项都成了0，该替换对于$\alpha$的小的值是合法的。
在控制理论中，小角度变化经常被用来近似描述系统的动态特性，这种情况下，系统的响应可通过线性模型来预测和控制，这大大简化了控制器的设计和调试。
同时，小角度变化也可用于运动稳定性的分析和设计。
例如，在机器人控制中，小角度变化可用于设计机器人的姿态控制器，以保持其稳定性和精度。

## 5.4 有效的旋转顺序

到目前为止，我们还没有指定哪些坐标旋转序列能够覆盖所有三维旋转空间。事实上，在{1,2,3}中的27个可能的三个整数序列中，只有12个满足以下约束条件：在有效序列中，不能有两个连续的数字相等。它们是

(i,j,k)∈{(1,2,1),(1,2,3),(1,3,1),(1,3,2),(2,1,2),(2,1,3),(2,3,1),(2,3,2),(3,1,2),(3,1,3),(3,2,1),(3,2,3)}。(48)

粗体的三个(1,2,3)、(3,1,3)和(3,2,3)是最常见的选择。这三种约定在表3中进行了对比，并且第一种和第二种现在进行了讨论。

## 5.5 欧拉角顺序(3,1,3)
### 5.5.1 用法
解释了来历，三个轴的定义
### 5.5.2 欧拉角 => 旋转矩阵
* $R_{313}$矩阵。我们给出了验证，而且是自动化的。
* L(R)，线性化后的矩阵。
* 旋转矩阵关于欧拉角的导数
### 5.5.3 欧拉角 <= 旋转矩阵
直接给出了公式。
用到了asin,acos,atan2等函数。并未验证，用肉眼看出来的。
顺便还给出了从单位四元数的旋转矩阵到欧拉角的转换。

### 5.5.4 欧拉角 => 欧拉角速率矩阵
看不懂
不过，这里给了逆矩阵，能否通过我的算法直接给出？貌似不行，因为没有化简。
是否能够写一个化简函数，自动处理（这里只有三个角的正弦和余弦）
### 5.5.5 欧拉角 => 四元数
直接给出了公式，并没有推导过程。
### 5.5.6 奇异性
给出了 $\theta = n*\pi$ 时会奇异。
所有形如(i,j,i)的旋转的参数化都有这类奇异性问题。
这类和其他奇异性问题在 5.8 节讨论。

## 5.6 欧拉角顺序(1,2,3)
5.6.1 用法
5.6.2 欧拉角 => 旋转矩阵
R, R_L(线性化), 偏导数矩阵, 
5.6.3 欧拉角 <= 旋转矩阵
5.6.4 欧拉角 => 欧拉角速率矩阵
5.6.5 欧拉角 => 四元数
5.6.6 奇异性。

## 5.7 选择的三角函数的导数。
由于使用了各种三角函数，大多数的导数对读者是熟悉的，但有三个值得关注。
atan2的两个偏导数，asin,acos的两个导数。

## 5.8 奇异性
各种欧拉角表示中发现的奇异性称为 gimbal lock。
分析了当$cos(\theta)=0$时，使得从矩阵计算欧拉角时出现了除零的错误。
常用策略是当物体接近歧义时改变其表示。
更流行的是使用但为四元数，可完全避免这个问题。
而且单位四元数还有很多注明的好处，在第6节讨论。
其主要缺点是，它们有单位长度的约束条件。
这个限制在许多情况下是无关紧要的，但在尝试优化四元数参数时可能会导致复杂性。
这是因为单位范数的约束是二次形式的，因此在大多数标准优化技术中无法包含该约束。

## 5.9 Intra-Euler-Angle Conversion 欧拉角内部转换，
为避免万向锁，有时需要在表示之间转换。
本节提供了 (3,1,3) 到 (1,2,3) 的转换，以及过滤应用所需的雅克比矩阵。
5.9.1 (3,1,3) <= (1,2,3)
原理是，先得到(1,2,3)的旋转矩阵，然后从该矩阵解除(3,1,3)对应的角度。
Jacobian of this function？不理解。需要补充一些知识。
5.3.2 (3,1,3) => (1,2,3)

## 6. 四元数
## 6.1 一般四元数
记号，共轭，长度，逆
## 6.2 四元数乘法
多种计算方式的公式，也引入了 skew-symmetric cross product matrix function $C:R^3\rightarrow R^{3\times 3}$。
## 6.3 四元数 => 四元数矩阵
四元数乘法可以写成第二个四元数的矩阵形式预乘以第一个四元数。
给出了四元数矩阵函数 $Q:H\rightarrow R^{4\times 4}$。
也给出了共轭四元数矩阵 $\bar{Q}$。
矩阵乘法函数的偏导数，有一个有趣的性质。
【对自变量为四元数求导，起始是对四个分量分别求导】
## 6.4 单位四元数 => 旋转矩阵
给出了公式，并有一个有趣的性质，四元数相乘后的矩阵，等于各自的矩阵再相乘。
还给出了此旋转矩阵对各分量的导数。
## 6.5 单位四元数 <= 旋转矩阵
说这个方向更难。因为需要一点技巧来构造。
但还是给出了一个分段函数形式的表达式。
## 6.6 四元数变化率 => 角速度
单位四元数对时间的导数是四元数变化率，它与角速度有关。
## 6.7 四元数变化率 <= 角速度
## 6.8 四元数变化率 => 角加速度
## 6.9 四元数变化率 <= 角加速度
## 6.10 单位四元数 <= Cayley-Klein Parameters
## 6.11 单位四元数 => Cayley-Klein Parameters
## 6.12 单位四元数 <= 轴角
## 6.13 单位四元数 => 轴角
## 6.14 单位四元数 <= 欧拉角
一个特定欧拉角顺序引起的但为四元数可写作三个轴角单位四元数的乘积。
## 6.15 单位四元数 => 欧拉角
方法是，先四元数到旋转矩阵，然后旋转矩阵到欧拉角。可以给出最后的公式。
## 6.16 四元数的优化。

# 7. 旋转向量表示法
轴角是 $(\alpha, \hat{n})$，而旋转向量是 $\alpha \hat{n}$。
## 7.1 旋转向量 <= 轴角
## 7.2 旋转向量 => 轴角
## 7.3 旋转向量 => 单位四元数
## 7.4 旋转向量 <= 单位四元数
## 7.5 旋转向量 => 四元数矩阵
## 7.6 旋转向量 => 四元数变化率矩阵
## 7.7 旋转向量 => 旋转矩阵
## 7.8 旋转向量乘法
定义为对应的四元数的乘法，然后再转换回来。
## 7.9 旋转向量变化率 => 四元数变化率
## 7.10 旋转向量变化率 => 角速度
## 7.11 旋转向量变化率 <= 四元数变化率
## 7.12 角速度的积分
  通过对机体角速度对时间的积分，适合于用四元数来跟踪机体的姿态。

# 8. 欧拉角参数化的目录
page23~page34，1页正好是1种。
展示了12中不同欧拉角的参数化，包括与旋转矩阵和四元数的转换过去和转换回来，
欧拉角速率和角速度的关系，关于欧拉角的基本结论的各种积分。




