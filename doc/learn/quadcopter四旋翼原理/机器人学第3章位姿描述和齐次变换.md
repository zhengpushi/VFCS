#### 《机器人学：建模控制与视觉》第3章 位姿描述和齐次变换

研究机器人运动和操作的第一步，是描述连杆之间，以及连杆和操作对象（工件或工具）之间的相对运动关系。
刚体的位置（position）和方位姿态（orientation，也称姿态、朝向）统称为刚体的位姿（location或pose），其描述方法有：齐次变换方法、矩阵指数方法和四元数方法等。
本章终点是齐次变换方法，其优点在于它将运动、变换和映射与矩阵的运算联系起来，具有明显的几何特征。
相对于参考坐标系，点的位置可以用三维列向量$\symbfit{p}\in\mathbb{R}^3$表示；刚体的朝向可用$3\times 3$的旋转矩阵$\symbfit{R}$来表示；刚体位姿可用$4\times 4$的齐次变换矩阵$\symbfit{T}$表示。
本章深入阐述旋转矩阵$\symbfit{R}$和刚体变换矩阵$\symbfit{T}$的性质，引入两个矩阵群：$SO(3)$和$SE(3)$。
所有旋转矩阵$\symbfit{R}$构成旋转矩阵群$SO(3)$；所有刚体变换矩阵$\symbfit{T}$构成刚体变换群$SE(3)$。

## 3.1 刚体的位姿描述
我们需要一种描述刚体位姿、速度和加速度的有效而简便的方法。
除了齐次变换方法之外，还有矢量法、李群和四元数等数学描述方法。
本章终点介绍齐次变换。

### 3.1.1 位置矢量
对于选定的直角坐标系$\{\symbfit{A}\}$，空间任意点$\symbfit{p}$的位置可用3维列矢量${}^A\symbfit{p}$表示，即用位置矢量表示：
$$
{}^A\symbfit{p} = \begin{bmatrix}p_x\\p_y\\p_z\end{bmatrix}
$$
式中：$p_x,p_y,p_z$是点$\symbfit{p}$在坐标系$\{\symbfit{A}\}$中的三个坐标分量。
${}^A\symbfit{p}$的上标$A$代表选定的参考坐标系$\{\symbfit{A}\}$。
除了直角坐标系外，还可采用圆柱坐标系或球（极）坐标系来描述点的位置。

### 3.1.2 旋转矩阵与旋转群
为描述空间某刚体$B$的方位，可设一直角坐标系$\{\symbfit{B}\}$与此刚体固连。
用坐标系$\{\symbfit{B}\}$的三个单位主矢量$\symbfit{x}_B,\symbfit{y}_B,\symbfit{z}_B$相对于坐标系$\{\symbfit{A}\}$的方向余弦组成的$3\times3$的余弦矩阵来表示刚体$B$相对于坐标系$\{\symbfit{A}\}$的的方位：
$$
{}_B^A\symbfit{R} = \begin{bmatrix}
{}^A\symbfit{x}_B & 
{}^A\symbfit{y}_B & 
{}^A\symbfit{z}_B
\end{bmatrix}
$$
或
$$
{}_B^A\symbfit{R} = \begin{bmatrix}{}
r_{11} & r_{12} & r_{13} \\
r_{21} & r_{22} & r_{23} \\
r_{31} & r_{32} & r_{33} \\
\end{bmatrix}
$$
式中：${}_B^A\symbfit{R}$称为旋转矩阵，上标$A$代表参考坐标系$\{\symbfit{A}\}$，下标代表被描述的坐标系$\{\symbfit{B}\}$。
矩阵${}_B^A\symbfit{R}$的9个元素中只有3个是独立的，满足6个约束条件（被称为正交条件）：列矢量都是单位主矢量，且两两相互垂直。
因此，旋转矩阵${}_B^A\symbfit{R}$是正交的。
又由于我们选用右手系，即矩阵第1列和第2列的叉乘后得到第3列，依此类推，使得矩阵的行列式为1（称为特殊条件）。
注意：如果选择左手系，则矩阵的行列式为-1，并且两个旋转矩阵相乘后又会使得行列式为1，这称为不一致的变换。

[定义]满足正交条件和特殊条件的旋转矩阵$\symbfit{R}\in\mathbb{R}^{3\times3}$的集合定义为旋转群$SO(3)$，即
$$
SO(3)=\{\symbfit{R}\in\mathbb{R}^{3\times3}|\symbfit{RR}^\mathsf{T}=\symbfit{I},\mathsf{det}\symbfit{R}=1\}
$$
旋转群也称为特殊正交群（special orthogonal group）。
推广到$\mathbb{R}^{n\times n}$空间中得到
$$
SO(n)=\{\symbfit{R}\in\mathbb{R}^{n\times n}|\symbfit{RR}^\mathsf{T}=\symbfit{I},\mathsf{det}\symbfit{R}=1\}
$$
其维数为$\frac{n(n-1)}{2}$的流形，当$n=3$时表示空间转动，当$n=2$时表示平面转动。

可验证，旋转矩阵对于矩阵乘法满足群公理条件。
值得说明的是，旋转矩阵集合构成的流形是光滑流形，且矩阵乘法运算和求逆运算都是光滑映射，因此旋转群是李群。

绕$x,y,z$轴旋转$\theta$角的旋转矩阵分别为
$$
\symbfit{R}(x,\theta)=\begin{bmatrix}
1 & 0 & 0\\
0 & \cos\theta & -\sin\theta\\
0 & \sin\theta & \cos\theta\\
\end{bmatrix},\quad
\symbfit{R}(y,\theta)=\begin{bmatrix}
\cos\theta & 0 & \sin\theta\\
0 & 1 & 0\\
-\sin\theta & 0 & \cos\theta\\
\end{bmatrix},\quad
\symbfit{R}(z,\theta)=\begin{bmatrix}
\cos\theta & -\sin\theta & 0\\
\sin\theta & \cos\theta & 0 \\
0 & 0 & 1\\
\end{bmatrix}
$$

### 3.1.3 坐标系的描述
为完全描述刚体$B$在空间的位姿，需要规定其位置和姿态。
将物体$B$与坐标系$\{\symbfit{B}\}$固连。坐标系$\{\symbfit{A}\}$的原点一般选在物体的特征点上，如质心或对称中心等。
相对于参考坐标系（简称参考系）$\{\symbfit{A}\}$，用位置矢量${}^A\symbfit{p}_{B_0}$描述坐标系$\{\symbfit{B}\}$原点的位置，用旋转矩阵${}_B^A\symbfit{R}$描述坐标系$\{\symbfit{B}\}$的姿态。因此，坐标系${}_B^A\symbfit{R}$的位姿完全由这二者来确定，即
$$
\{\symbfit{B}\} = \{{}_B^A\symbfit{R}\quad {}^A\symbfit{p}_{B_0}\}
$$
坐标系的描述概括了刚体位置和姿态的描述。当表示位置时，式中的旋转矩阵$\{{}_B^A\symbfit{R} = \symbfit{I}$；当表示姿态时，式中的位置矢量$\quad {}^A\symbfit{p}_{B_0}=\symbfit{0}$。

### 3.1.4 坐标变换
空间中任一点$\symbfit{p}$在不同坐标系中的描述是不同的。下面讨论点$\symbfit{p}$从一个坐标系的描述到另一个坐标系的描述之间的映射关系，即坐标变换。
1. 坐标平移
设坐标系$\{\symbfit{B}\}$与$\{\symbfit{A}\}$具有相同的方位，但是坐标原点不重合，用位置矢量${}^A\symbfit{p}_{B_0}$描述$\{\symbfit{B}\}$相对于$\{\symbfit{A}\}$的位置，如图3-2所示。把${}^A\symbfit{p}_{B_0}$称为$\{\symbfit{B}\}$相对于$\{\symbfit{A}\}$的平移矢量。同一个点$\symbfit{p}$在两个坐标系中的描述${}^A\symbfit{p}$和${}^A\symbfit{p}$具有以下变换关系：
$$
{}^A\symbfit{p} = {}^B\symbfit{p} + {}^A\symbfit{p}_{B_0}
$$
式右端表示的操作称为坐标平移，或平移映射。

2. 坐标旋转
设坐标系$\{\symbfit{B}\}$与$\{\symbfit{A}\}$具有共同的坐标原点，但两者的姿态不同，如图3-3所示。用旋转矩阵${}_B^A\symbfit{R}$描述$\{\symbfit{B}\}$相对于$\{\symbfit{A}\}$的姿态。同一个点$\symbfit{p}$在两个坐标系中的描述${}^A\symbfit{p}$和${}^A\symbfit{p}$具有以下变换关系：
$$
{}^A\symbfit{p} = {}_B^A\symbfit{R}{}^B\symbfit{p}
$$
式右端表示的操作称为坐标旋转，或旋转映射。

同样，可用${}_A^B\symbfit{R}$描述$\{\symbfit{A}\}$相对于$\{\symbfit{B}\}$的姿态。${}_A^B\symbfit{R}$和${}_B^A\symbfit{R}$都是正交矩阵，二者互逆。根据正交矩阵的性质，得出
$$
{}_A^B\symbfit{R} = {}_B^A\symbfit{R}^{-1}={}_B^A\symbfit{R}^{\mathsf{T}}
$$

3. 一般刚体变换
最一般的情形是：坐标系$\{\symbfit{B}\}$与$\{\symbfit{A}\}$不但原点不重合，而且姿态也不相同，如图3-4所示。用位置矢量${}^A\symbfit{p}_{B_0}$描述$\{\symbfit{B}\}$相对于$\{\symbfit{A}\}$的位置；用旋转矩阵${}_B^A\symbfit{R}$描述$\{\symbfit{B}\}$相对于$\{\symbfit{A}\}$的姿态。任意点$\symbfit{p}$在两个坐标系中的描述${}^A\symbfit{p}$和${}^A\symbfit{p}$具有以下变换关系：
$$
{}^A\symbfit{p} = {}_B^A\symbfit{R}{}^B\symbfit{p} + {}^A\symbfit{p}_{B_0}
$$
式右端表示的操作可看成是坐标旋转和坐标平移的复合变换。
实际上，可规定一个过渡坐标系坐标系$\{\symbfit{C}\}$，使$\{\symbfit{C}\}$的坐标原点与$\{\symbfit{B}\}$的重合，而$\{\symbfit{C}\}$的方位与$\{\symbfit{A}\}$的相同。根据旋转变换，得到向过渡坐标系的变换：
$$
{}^C\symbfit{p} = {}_B^C\symbfit{R}{}^B\symbfit{p}
$$
再由平移变换，得到复合变换：
$$
{}^A\symbfit{p} = {}^C\symbfit{p} + {}^A\symbfit{p}_{C_0} 
= {}_B^A\symbfit{R}{}^B\symbfit{p} + {}^A\symbfit{p}_{B_0}
$$

例3.1，可在Coq中建模算法，然后在OCaml中验证数值解。

## 3.2 齐次坐标和齐次变换
复合变换式（一般刚体变换）对点${}^B\symbfit{p}$而言是非齐次的，可以将其表示成等价的齐次变换形式：
$$
\begin{bmatrix}{}^A\symbfit{p}\\1\end{bmatrix}
= \begin{bmatrix}{}_B^A\symbfit{R} & {}^A\symbfit{p}_{B_0}\\\symbf{0} & 1\end{bmatrix}
\begin{bmatrix}{}^B\symbfit{p}\\1\end{bmatrix}
$$
或表示成矩阵形式：
$$
{}^A\symbfit{p} = {}_B^A\symbfit{T}{}^B\symbfit{p}
$$
此处，位置矢量${}^A\symbfit{p}$和${}^B\symbfit{p}$都是$4\times 1$的列矢量，与复合变换式中的维数不同，其中加入了第4个分量1。这两个列矢量称为点$p$的齐次坐标。
变换矩阵${}_B^A\symbfit{T}$是$4\times4$的方阵，具有如下形式：
$$
{}_B^A\symbfit{T}
= \begin{bmatrix}{}_B^A\symbfit{R} & {}^A\symbfit{p}_{B_0}\\\symbf{0} & 1\end{bmatrix}
$$
矩阵${}_B^A\symbfit{T}$称为齐次变换矩阵，特点是最后一行元素为$\begin{bmatrix}0&0&0&1\end{bmatrix}$。它综合了平移变换和旋转变换。
可以验证，复合变换式和齐次变换式二者等价。实质上，将变换矩阵式展开后可得到方程组
$$
\begin{cases}
{}^A\symbfit{p} = {}_B^A\symbfit{R}{}^B\symbfit{p} + {}^A\symbfit{p}_{B_0}\\
1 = 1
\end{cases}
$$
齐次变换式的优点在于表达方便，书写紧凑，但是使用它来编写程序并不简便，因为乘1和0是在做无用的计算。
位置矢量${}^A\symbfit{p}$和${}^B\symbfit{p}$究竟是$3\times1$的列矢量（直角坐标），还是$4\times 1$的列矢量（齐次坐标），根据与它相乘的矩阵是$3\times3$的还是$4\times4$的而定。
