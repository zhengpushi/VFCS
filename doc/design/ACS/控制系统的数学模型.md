# 控制系统的数学模型

## 关于数学模型

* 两种类型
  * 时域模型——微分方程
  * 复域模型——传递函数（transfer function）

* 定义：描述系统输入、输出变量以及内部各变量之间关系的数学表达式
* 建模方法
  * 解析法（机理分析法）
    * 白盒，根据系统工作所依据的物理定律列写运动方程。
  * 实验法（系统辨识法）
    * 灰盒，给系统施加某种测试信号，记录输出相应，并用适当的数学模型去逼近系统的输入输出特性。

## 微分方程

### 线性定常系统微分方程

* 一般形式

  * 一般形式（规范形式）：
    $$
    \begin{equation}
    \begin{aligned}
    &a_n\frac{\mathrm{d}^n c(t)}{\mathrm{d}t^n} + a_{n-1}\frac{\mathrm{d}^{n-1} c(t)}{\mathrm{d}t^{n-1}}+\ldots+a_1\frac{\mathrm{d} c(t)}{\mathrm{d}t}+a_0 c(t) = \\
    &b_m\frac{\mathrm{d}^m r(t)}{\mathrm{d}t^m} + b_{m-1}\frac{\mathrm{d}^{m-1} r(t)}{\mathrm{d}t^{m-1}}+\ldots+b_1\frac{\mathrm{d} r(t)}{\mathrm{d}t}+b_0 r(t)
    \end{aligned}\label{itl_de_form}
    \end{equation}
    $$

  * 输入信号$r(t)$，输出信号$c(t)$，取名为入和出的意思。因为$i$用作整型循环变量，$o$用作原点符号。

  * 线性：满足叠加原理时。

  * 叠加原理：输入是$a\cdot r_1(t)\pm b\cdot r_2(t)$时，输出为$a\cdot c_1(t)\pm b\cdot c_2(t)$。

  * 一般形式：等式左侧都是与输出有关（包括输出、输出的各阶导数），等号右边都是与输入有关（包括输入、输入的各阶导数）。不能出现：交叉乘积项、常数项。每一项必须是输入输出项或者是输入输出项的各阶导数。

  * 证明：满足该形式的系统，一定满足叠加原理。【是否需要在Coq中证明？】

  * 是否线性？看变量

  * 是否定常？看系数。如果至少有一个系数随时间变化，则称时变系统，否则是定常系统。

* 线性时不变系统（LTI：Linear, Time-Invariant System）

## 传递函数

### 定义

* 定义：零初始条件下线性系统响应（即输出）量的拉普拉斯变换（或z变换）与激励（即输入）量的拉普莱斯变换之比。记做$G(s) = Y(s)/U(s)$。

* 用途：通常用于分析单输入、单输出的滤波器系统中，主要用在信号处理、通信理论、控制理论。

* 备注1：在控制空城和控制理论中，传递函数是从拉普莱斯变换推导而来。传递函数是经典控制工程中的一个主要工具，但在分析多输入多输出（MIMO）系统时显得笨拙，在分析这样的系统时大部分被**状态空间**所代替。尽管如此，经常也可以从任意线性系统得到传递矩阵用于分析它的动态及其它特性：传递矩阵的每个元素都是与特定输入和特定输出相关的一个传递函数。

* 根据微分方程的规范形式得到传递函数

  首先，对$\eqref{itl_de_form}$的两边进行拉氏变换
  $$
  [a_ns^n+a_{n-1}s^{n-1}+\ldots+a_1s+a_0]C(s)=[b_ms^m+b_{m-1}s^{m-1}+\ldots+b_1s+b_0]R(s)
  $$
  得到传递函数
  $$
  G(s)=\frac{C(s)}{R(s)}=\frac{b_ms^m+b_{m-1}s^{m-1}+\ldots+b_1s+b_0}{a_ns^n+a_{n-1}s^{n-1}+\ldots+a_1s+a_0}
  $$

* 首1标准型

  将分子和分母首项的系数都化为1。

* 首1标准型的乘积形式

  若将分子和分母多项式分解为乘积形式，如下也是首1标准型
  $$
  G(s)=\frac{K^*\prod_{i=1}^{n}(s-z_i)}{\prod_{i=1}^{m}(s-p_i)}
  $$

* 尾1标准型：将分子和分母尾项的系数都化为1。此时前面的系数称为**增益**。

### 示例1

将如下传递函数化为首1、尾一标准型，并确定其增益。
$$
G(s)=\frac{4s-4}{s^3+3s^2+2s}
$$
首1标准型
$$
G(s)=\frac{4s-4}{s^3+3s^2+2s}=\frac{4(s-1)}{s(s+1)(s+2)}
$$
尾1标准型
$$
G(s)=\frac{4}{2}\cdot\frac{s-1}{s(\frac{1}{2}s^2+\frac{3}{2}s+s)}=2\cdot\frac{s-1}{s(\frac{1}{2}s+1)(s+1)}
$$
 注意：提取尾1时，要保证分子和分母的首项系数都是正的，而尾项是否为正无所谓（即$\pm1$都可以）。

增益
$$
K=2
$$

### 传递函数的性质

1. G(s)是复函数。因为G(s)是关于s的有理分式。

2. G(s)只与系统自身的结构参数有关

3. G(s)与系统微分方程直接关联

4. $G(s)=L[k(t)]$。其中，$k(t)$表示系统的单位脉冲响应。因为如果输入是单位脉冲，则输出就是单位脉冲响应，而输入的单位脉冲进行拉式变换后是$1$。其中，$1$表示一个复函数，输入任何值输出都是复数$1$。

5. G(s)与$s$平面上的零极点图相对应。因为分子多项式对应的根是零点，分母多项式对应的根是极点。

   注意，$s$平面是自变量的取值范围，而$g$平面是函数平面。

   另外，在零极点图上缺少增益信息，有了增益后就可以还原$G(s)$。

### 示例2（关于时域、复域的一个综合题目）

已知某系统在0初条件下的单位阶跃响应为：$c(t)=1-\frac{2}{3}e^{-t}-\frac{1}{3}e^{-4t}$，求：1) 系统的传递函数；2) 系统的增益；3) 系统的特征根及相应的模态；4) 画出对应的零极点图；5) 求系统的单位脉冲响应；6) 求系统微分方程；7) 当$c(0)=-1, c'(0)=0, r(t)=1(t)$时，求系统的响应。

解：

1. 根据定义，传递函数是输出与输入的拉氏变换之比。

   输出的拉氏变换
   $$
   C(s)=\frac{1}{s}-\frac{2}{3}\frac{1}{s+1}-\frac{1}{3}\frac{1}{s+4}=\frac{2(s+2)}{s(s+1)(s+4)}
   $$
    输入的拉氏变换是$1/s$，所以
   $$
   G(s)=\frac{C(s)}{R(s)}=\frac{C(s)}{1/s}=s\cdot G(s)=\frac{2(s+2)}{(s+1)(s+4)}
   $$

2. 增益
   $$
   K=\frac{2\times 2}{4}=1
   $$

3. 系统的特征根及相应的模态

   特征根
   $$
   \lambda_1=-1,\lambda_2=-4
   $$
   对应的模态
   $$
   e^{-t}, e^{-4t}
   $$
   注意：系统的单位脉冲响应，就是对应模态的线性组合。

4. 对应的零极点图

   零点：使分子为零的s的值；极点：使分母为零（也即使得整体为无穷）的s的值。

   ![Zero and Poles](.\figures\example_zero_and_poles.png)

   其中，零点用圆圈表示，极点用叉表示。此处，零点只有一个：$-2$，极点有两个：$-1,-4$。

   注意，除增益外，零极点图和传递函数是一一对应的。

5. 单位脉冲响应

   对传递函数进行拉氏反变换。
   $$
   k(t)=L^{-1}[G(s)]=L^{-1}\left[\frac{2(s+2)}{(s+1)(s+4)}\right]=L^{-1}\left[\frac{C_1}{s+1}+\frac{C_2}{s+4}\right]
   $$
   用单根的留数法求出$C_1,C_2$
   $$
   C_1=\lim_{s\rightarrow -1}\frac{2(s+2)}{s+4}=\frac{2}{3}, C_2=\frac{4}{3}
   $$
   代入
   $$
   k(t)=L^{-1}\left[\frac{2}{3}\frac{1}{s+1}+\frac{4}{3}\frac{1}{s+4}\right]=\frac{2}{3}e^{-t}+\frac{4}{3}e^{-4t}
   $$

6. 系统微分方程

   首先写出传递函数
   $$
   G(s)=s\cdot G(s)=\frac{2(s+2)}{(s+1)(s+4)}=\frac{2s+4}{s^2+5s+4}=\frac{C(s)}{R(s)}
   $$
   将输出和输入的拉式变换与传递函数分子分母交叉相乘，恢复推导过程
   $$
   =(s^2+5s+4)C(s)=(2s+4)R(s)
   $$
   由于传递函数是在零初始条件下推导的，所以可以直接写出对应的拉氏反变换
   $$
   L^{-1}:\ddot{c}+5\dot{c}+c=2\dot{r}+4r
   $$
   而一旦写出微分方程以后，它就不受零初始条件的制约。

7. 当$c(0)=-1, c'(0)=0, r(t)=1(t)$时（即在单位阶跃信号作用下），求系统的响应

   初始条件非零，就要从微分方程入手，而不是传递函数。

   先写出微分方程
   $$
   L^{-1}:\ddot{c}+5\dot{c}+c=2\dot{r}+4r
   $$
   对其两端进行拉式变换，此时带上初始条件
   $$
   L:[s^2C(s)-sc(0)-\dot{c}(0)]+5[sC(s)-c(0)] + [4C(s)]=2sR(s)+4R(s)
   $$
   整理
   $$
   (s^2+5s+4)C(s)-(s+5)c(0)-\dot{c}(0)=2(s+2)R(s)
   $$
   由$r(t)=1(t)$得，$R(s)=1/s$，再代入$c(0),c'(0)$并整理得
   $$
   C(s)=\frac{2(s+2)}{s^2+5s+4}\cdot\frac{1}{s}-\frac{s+5}{s^2+5s+4}=\frac{-s^2-3s+4}{s(s+1)(s+4)}
   $$
   其中，$C(s)$由第<1>和第<2>两部分组成，通分以后是整体<3>。

   用<3>进行拉氏反变换得到的，既有单位阶跃激励，又有初始条件响应的一个综合。

   用<1>单独进行拉氏反变换，是系统的单位阶响应的表达式。

   第<2>单独进行拉氏反变换，是初始条件引起的自由响应的分量。

   所以总的响应是这两部分的和，因为系统满足叠加原理。

   现在，有两种方法：要么直接对<3>拉氏反变换，要么对<1>,<2>分别处理，因为<1>已经在开头处理好了。

   我们先对<2>进行拉氏反变换。$C_0(s)$是初始条件引起的自由响应部分。
   $$
   C_0(s)=\frac{-(s+5)}{(s+1)(s+4)}=\frac{C_1}{s+1}+\frac{C_1}{s+4}
   $$
   求得，$C_1=-4/3,C_2=1/3$， 然后拉氏反变换
   $$
   c_0(t)=\frac{-4}{3}e^{-t}+\frac{1}{3}e^{-4t}
   $$
   然后给出总的响应
   $$
   c(t)=c_r(t)+c_0(t)=\left(1-\frac{2}{3}e^{-t}-\frac{1}{3}e^{-4t}\right)+\left(\frac{-4}{3}e^{-t}+\frac{1}{3}e^{-4t}\right)=1-2e^{-t}
   $$

### 传递函数的局限性

* 原则上不反映非零初始条件时系统响应的全部信息
* 适合于描述单输入、单输出系统
* 只能用于表示线性定常系统

### 传递函数的小结

* 零初始条件：在$t=0$之前，系统的输出、输入、以及它们的各阶导数全部为零。

## 常用控制元件的传递函数

* 引言：怎么从一个实际的系统找到它的传递函数？回想建模思路：

  * 先有一个实际的系统，或者用示意图描述的系统；
  * 然后搞清楚工作原理；
  * 画出方框图，理清信号流动的关系，每个方框对应系统中一个特定的元部件；
  * 找出每个元件的传递函数，用传递函数来代替其名字，这样不但理清了信号传递的关系，也精确的定量了信号，就构成了结构图。结构图精确的描述了输入、输出、以及中间变量之间的数学传递关系，可以作为系统的数学模型了。
  * 由结构图，可以找出最终的系统输入输出的闭环传递函数。

* 现在解决一个问题，如何从元部件找出其传递函数？完成以后就可以从实际系统或方框图到达结构图。

* 常用控制元件的传递函数。包括一些典型元部件，理解如何从实际系统抽象出数学模型。

  * 电位器：将位置信号转变为电压信号。

    * 条形：将线位移转为电信号。
    * 圆弧：将角位移转换为电信号。
    * $G(s)=\frac{U(s)}{\Theta(s)}=K_p$

  * 自整角机

  * 两相异步电动机

    * 堵转力矩：$M_s(t)=c_m\cdot u_a(t)$，控制电压越大，力矩越大

    * 机械特性：$M_m(t)=M_s(t)-c_{\omega}\cdot \omega(t)$，转速越快时，电磁力矩就越小，最大就是堵转力矩。

    * 牛顿定律（力矩平衡方程）：$J_m\dot{\omega}(t)=M_m(t)-f_m\omega(t)$，

      * 转动惯量乘以角加速度等于作用在这个轴上的合力矩。
      * 转动轴上的粘滞摩擦系数乘以角速度是粘滞摩擦力矩（也称负载力矩）。
      * 主动力矩（电磁力矩）减去负载力矩，等于合力矩。

    * 如何得到传递函数，两种方法：

      * 方法一：

        输入是电压$u_a(t)$，输出是角速度$\omega(t)$，两个中间变量$M_s(t), M_m(t)$，消去得到：

      $$
      T_m\dot{\omega}(t)+\omega(t)=K_m\cdot u_a(t)
      $$

      其中，电机时间常数$T_m=J_m/(f_m+c_{\omega})$，电机传递系数$K_m=c_m/(f_m+c_{\omega})$

      于是，传递函数为
      $$
      G(s)=\frac{\Omega(s)}{U_m(s)}=\frac{K_m}{T_ms+1}
      $$

      * 方法二：

        对三个方程同时进行拉氏变换，得到三个子的传递函数，以及三个子的结构图，最后再化简合成。

  * 齿轮系

### 典型环节

* 引言：由于系统部件非常多，我们无法穷尽，为了数学上方便的表达，我们对元部件进行抽象的分类。

* 环节：具有相同形式传递函数的元部件的分类。

  * 不同元部件可以有相同的传递函数
  * 输入输出变量选择不同，同一部件可以有不同的传递函数
  * 任一传递函数都可看作典型环节的组合

* 典型环节：对环节的进一步分类或抽象。

* 典型环节及其传递函数

  | 序号 | 环节名称         | 微分方程                                         | 传递函数                       | 例                          |
  | ---- | ---------------- | ------------------------------------------------ | ------------------------------ | --------------------------- |
  | 1    | 比例环节         | $c=K\cdot r$                                   | $K$                            | 电位器、放大器、自整角机    |
  | 2    | 惯性环节         | $T\dot{c}+c=r$                                 | $\frac{1}{Ts+1}$             | CR电路，交、直流电动机      |
  | 3    | 振荡环节         | $T^2\ddot{c}+2\xi T\dot{c}+c=r$<br>$0<\xi<1$ | $\frac{1}{T^2s^2+2\xi Ts+1}$ | RLC电路，弹簧质块阻尼器系统 |
  | 4    | 积分环节         | $\dot{c}=r$                                    | $\frac{1}{s}$                | 水箱，(流量Q -- 液位h)      |
  | 5    | 微分环节         | $c=r$                                          | $s$                          | （是4的倒数） |
  | 6    | 一阶复合微分环节 | $c=\tau \dot{r}+r$                             | $\tau s + 1$                 | （是2的倒数） |
  | 7    | 二阶复合微分环节 | $c=\tau^{2}\ddot{r}+2\tau\xi \dot{r}+r$        | $\tau^{2}s^2+2\tau\xi s+1$   | （是3的倒数） |

  注意：

  1. 只有这7个典型环节，再没了。
  2. 只有比例环节的增益是$K$，其余六项都是$1$。
  3. 将传递函数的分子分母全部解开，并化成尾一标准型，则传递函数一定是这7个典型环节的传递函数的乘积。
  4. 典型环节可以看成是构成任何系统传递函数的最基本的单元。以后分析系统时如果比较复杂，可以从构成它的这些典型环节入手来分别分析。

* 还要注意到

  * 任何实际系统都是因果系统，只有给了输入（激励）信号后，才会有输出。这种系统抽象成数学模型以后，一般都是分子的阶低于分母的阶。所以5,6,7三种情形不一定能找到实际的物理系统与之对应。
  * 虽然5,6,7不一定存在物理对应，但使用它可以进行完整分类，不妨碍我们使用。

* 负载效应问题

  * 以电路的两部分连接和断开为例，会得到不同的结果。如果是要考虑负载时，则不能简单的断开处理，要注意整体。
  * 还有个例子，电机驱动火炮，要考虑负载时的情形。如果是电机空载时，情况很不同。
  * 所以，在建立系统数学模型，尤其是传递函数时，一定要在系统正常工作的环境之下建立某个变量到另一个变量的关系，一定要考虑负载效应。

### 总结：系统模型及其建立过程

* 建立过程
  * 工作原理图 -> 方框图
  * 元部件微分方程 $(L)\leftarrow; \rightarrow(L^{-1})$元部件传递函数
  * 微分方程组 $(L)\leftarrow; \rightarrow(L^{-1})$系统结构图
  * 微分方程组$\rightarrow (消去中间变量)\rightarrow$系统微分方程
  * 系统结构图$\rightarrow (结构图化简、Mason公式)\rightarrow$系统传递函数
  * 系统微分方程 $(L)\leftarrow; \rightarrow(L^{-1})$系统传递函数

* 总结
  * 时域，消去中间变量麻烦
  * 复域，消去中间变量比较方便。



